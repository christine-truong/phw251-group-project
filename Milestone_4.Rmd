---
title: "Milestone #4"
author: "Rachael Baartmans, Lara Petalio, Christine Truong"
date: "11-14-22"
output:
  pdf_document: default
  html_document: default
---
##Relevant Previous Importing and Data-cleaning Steps
```{r previous import and data cleaning steps, echo = F}
library(tidyverse)
library(knitr)
library(kableExtra)

#Insert previous code with updated datasets 
race_data <-read_csv("ca_csc_outcome_race_data.csv",
            col_select = c(ID, NERVOUS, WORRYING, PROBINTR,
                           PROBDOWN, ASTHMA, HEARTDIS,
                           DIABETES, OTHMENILL, race01, race02, race03,
                           race04, race05, race06, race07, race08,
                           race09, race10, race11, race12, race13,
                           race14, race15),
            na = c("", "NA", "NA/Not Applicable", "N/A", "n/a",
                   "(DO NOT READ) NA/Not Applicable",
                   "(DO NOT READ) Refused",
                   "(DO NOT READ) Don't know"))

smoker_data <- read_csv("ca_csc_smoker_data.csv",
            col_select = c(psraid, smokstat, WHEREBUY, BUYCALIF,
                           HOWMANY, SMOK6NUM, SMOK6UNI),
            na = c("", "NA", "NA/Not Applicable", "N/A", "n/a",
                   "(DO NOT READ) NA/Not Applicable",
                   "(DO NOT READ) Refused",
                   "(DO NOT READ) Don't know"))

#Changed casing for variables from capitals to lowercase in both dataframes
#of race_data and smoker_data
names(race_data) <- tolower(names(race_data))
names(smoker_data) <- tolower(names(smoker_data))

#Re-coded "100 or more cigarettes" to "100" for future pack-year calculations
#once the variable `howmany` is converted from character to numeric data type
smoker_data$howmany <- recode(smoker_data$howmany,
                              "100 or more cigarettes" = "100")

#Changed the data type of `howmany` from character to numeric in order to
#perform calculations for pack-years later
smoker_data$howmany <- as.numeric(smoker_data$howmany)

#Re-coded "In military commissaries, or" to "In military commissaries", as well
#as "Somewhere else (SPECIFY)?" to "Somewhere else" to make
#response option more understandable when displayed for the variable `wherebuy`.
smoker_data$wherebuy <- recode(smoker_data$wherebuy,
                  "In military commissaries, or" = "In military commissaries",
                  "Somewhere else (SPECIFY)?" = "Somewhere else")

#Created new variable `race` to combine variables race01:race15 into one column. 
race_data_2 <- race_data %>%
  mutate(race = case_when(race01 == "Yes" ~ "White",
        race02 == "Yes" ~ "Black",
        race03 == "Yes" ~ "Japanese",
        race04 == "Yes" ~ "Chinese",
        race05 == "Yes" ~ "Filipino",
        race06 == "Yes" ~ "Korean",
        race07 == "Yes" ~ "Other Asian or Pacific Islander",
        race08 == "Yes" ~ "American Indian or Alaskan Native",
        race09 == "Yes" ~ "Mexican",
        race10 == "Yes" ~ "Hispanic/Latino",
        race11 == "Yes" ~ "Other",
        race12 == "Yes" ~ "Vietnamese",
        race13 == "Yes" ~ "Asian Indian",
        race14 == "Yes" ~ "Refused",
        race15 == "Yes" ~ "Don't know")) %>%
  select(-(race01:race15))

#Created new variable "packs_per_day" for future calculations for pack-years
smoker_data_2 <- smoker_data %>% mutate(packs_per_day = howmany/20)

```
  
  \newpage
  
## Milestone #4 assignments (delete this header later)

## Calculating Pack-years
```{r pack-years calculation}

#We calculated pack-years, which is given by the formula of
#pack-years = # of packs of cigarettes smoked per day * years a person has smoked.
#This calculation led to the creation of a new variable called `pack_years`.
#`pack_years` was created conditionally based on the three different time units
#as determined by the existing variable `smok6uni`, which are: "Days", "Months",
#and "Years". To change the unit of "Days" to years, we set up a conditional
#statement in the code to divide `smok6num` by 365 before multiplying the result
#by `packs_per_day` to get pack-years. Similarly, to change the unit of "Months"
#to years, we set up a conditional statement in the code to divide `smok6num`
#by 12 before multiplying the result by `packs_per_day` to get pack-years. For
#`smok6uni` observations that have the value "Years", we just multiplied
#`smok6num` by `packs_per_day` to get pack-years directly. We assigned
#this overall change in the data frame smoker_data_2 to a new data frame
#called smoker_data_3, which includes the new variable `pack_years`.

smoker_data_3 <- smoker_data_2 %>%
  mutate(pack_years =
           case_when(smok6uni == "Days" ~ packs_per_day*(smok6num/365),
                     smok6uni == "Months" ~ packs_per_day*(smok6num/12),
                     smok6uni == "Years" ~ packs_per_day*(smok6num)))

#We then rounded `pack_years` to the nearest whole number for all observations.

smoker_data_3$pack_years <- round(smoker_data_3$pack_years, 0)

#Afterwards, we viewed our new data frame, which includes our new variable
#`pack_years`.

smoker_data_3

```

\newpage

## Joining Cleaned Data Sets Together
```{r joining race_data_2 and smoker_data_3 together}

#In order to join our two cleaned data sets together, we first had to remove the
#strings of 'DIS' and 'STAT' from the `id` column of race_data_2 by using gsub().
#We overwrote these changes in the race_data_2 data frame and viewed these new
#changes to make sure the `id` variable only contains numbers and no
#characters.

race_data_2$id <- gsub('[DISSTAT]', '', race_data_2$id)
race_data_2

#Next, looking at the smoker_data_3 data frame, we see that the `psraid`
#variable contains each study participant's unique ID number, but the variable
#is a numeric data type. On the other hand, `id` from the race_data_2
#data frame is a character data type. We needed to convert `psraid` then from
#character to numeric data type because 1) `psraid` is an identifier rather than
#a numeric value to mathematically manipulate even if it does contain numbers
#and 2) in order to perform a join, the two variables must be the same data
#type.

smoker_data_3$psraid <- as.character(smoker_data_3$psraid)

#Afterward, we performed an inner join between race_data_2 and
#smoker_data_3 by each study participant's unique ID number, which is
#represented by `id` in race_data_2 and `psraid` in smoker_data_3. We
#chose to do an inner join because we wanted to select participants that
#exist in each of our two data sets for our final data frame.
#We assigned this join to a new data frame called joined_smoking_df.

joined_smoking_df <- inner_join(x = race_data_2, y = smoker_data_3,
                                by=c("id" = "psraid"))

#Then, we viewed the new data frame we created
joined_smoking_df

```

\newpage

## Determining Pack-years for Each Disease
```{r determining average pack-years with joined data by race per disease}

#We created subsets of the data frame joined_smoking_df for each disease of
#interest, with each subset including only the variable of `race` and average
#values of the variable `pack_years` according to disease. This is to simplify
#the graph and table generation process later by including only the information
#we need in a data frame.

#asthma
avg_pack_years_race_asthma <- joined_smoking_df %>%
  filter(!is.na(pack_years)) %>%
  group_by(race, asthma) %>%
  summarize(avg_pack_years = sum(pack_years)/n())

#heartdis
avg_pack_years_race_heartdis <- joined_smoking_df %>%
  filter(!is.na(pack_years)) %>%
  group_by(race, heartdis) %>%
  summarize(avg_pack_years = sum(pack_years)/n())

#diabetes
avg_pack_years_race_diabetes <- joined_smoking_df %>%
  filter(!is.na(pack_years)) %>%
  group_by(race, diabetes) %>%
  summarize(avg_pack_years = sum(pack_years)/n())

#othmenill
avg_pack_years_race_othmenill <- joined_smoking_df %>%
  filter(!is.na(pack_years)) %>%
  group_by(race, othmenill) %>%
  summarize(avg_pack_years = sum(pack_years)/n())
       
```
\newpage

## Visualizations

_**Average Pack-years by Disease Status (Two Complementary Tables)**_
```{r table 1 of cigarette pack-years by disease}

#Table for avg pack-years per disease for smokers who have a disease
t_avg_pack_years_disease <- joined_smoking_df %>%
  mutate(disease = case_when(asthma == "Yes" ~ "Asthma",
                            heartdis == "Yes" ~ "Heart Disease",
                            diabetes == "Yes" ~ "Diabetes",
                            othmenill == "Yes" ~ "Mental Illness")) %>%
  select(disease, pack_years) %>%
  filter(!is.na(pack_years), !is.na(disease)) %>%
  group_by(disease) %>%
  summarize(avg_pack_years = round(sum(pack_years)/n(), 0))
t_avg_pack_years_disease
```

```{r kable table 1 of cigarette pack-years by disease}

#Kable table for avg pack-years per disease for smokers who have a disease
kable(t_avg_pack_years_disease, 
      booktabs=T, 
      col.names=c("Disease", "Average Pack-years"),  
      align='lcccc', 
      caption= 'Average Pack-years for Smokers Who Have a Disease') %>%
      kable_styling(full_width = T) %>%
      kable_styling(latex_options = "hold_position")

```

```{r table 2 of cigarette pack-years by disease}

#Table for avg pack-years per disease for those who do not have a disease
t_avg_pack_years_no_disease <- joined_smoking_df %>%
  mutate(disease = case_when(asthma == "No" ~ "Does Not Have Asthma",
                            heartdis == "No" ~ "Does Not Have Heart Disease",
                            diabetes == "No" ~ "Does Not Have Diabetes",
                            othmenill == "No" ~ "Does Not Have Mental Illness")) %>%
  select(disease, pack_years) %>%
  filter(!is.na(pack_years), !is.na(disease)) %>%
  group_by(disease) %>%
  summarize(avg_pack_years = round(sum(pack_years)/n(), 0))
t_avg_pack_years_no_disease

```

```{r kable table 2 of cigarette pack-years by disease}

#Kable table for avg pack-years per disease for those who do not have a disease
kable(t_avg_pack_years_no_disease, 
booktabs=T, 
col.names=c("Disease", "Average Pack-years"),  
align='lcccc', 
caption= 'Average Pack-years Among Smokers Responding "No" to Having a Disease') %>%
      kable_styling(full_width = T) %>%
      kable_styling(latex_options = "hold_position")

```

#We created another table with all diseases present with yes/no statuses,
#showing unique combinations of diseases and the avg pack-years per combination
#table_option_2 <- joined_smoking_df %>%
  #filter(!is.na(pack_years)) %>%
  #group_by(asthma, heartdis, diabetes, othmenill) %>%
  #summarize(avg_pack_years = sum(pack_years)/n())
#table_option_2

_**Interpretation of the Three Tables of Average Pack-years by Disease Status:**_
\newline
Among smokers that have reported the presence of the diseases of interest (i.e., asthma, heart disease, diabetes, and mental illness), those with heart disease have the highest number of average pack-years (28), while those with mental illness have the lowest number of pack years (17). Among smokers that reported "no" to having a disease, those with no mental illness have the highest average pack years (102), while those with no asthma had the lowest average pack years (21).



\newpage

_**Average Pack-years by Race and Disease (Series of Four Graphs)**_
```{r bar graph of cigarette pack-years by race and asthma}

avg_pack_years_race_asthma %>%
  drop_na(c(asthma, avg_pack_years)) %>%
  ggplot(aes(x = race, y = avg_pack_years)) +
  geom_bar(aes(fill=race), stat="identity", position = "dodge") +
  coord_flip() +
  guides(fill = "none") +
  labs(x = "Race",
       y = "Average Pack-years (Avg. # of Cigarette Packs Smoked per Year)",
  title = "Average Pack-years by Race & Asthma Status",
  caption = "Data Source: 2011 California Smokers Cohort, CA Dept. of Health") +
  scale_y_continuous(labels = function(x) format(x,big.mark=",",
                                                     scientific=FALSE)) +
  facet_wrap(~ asthma, labeller = labeller(asthma =
                                             c( "Yes" = "Has Asthma","No" = "Does Not Have Asthma"
                                                     )))

```
\newpage
```{r bar graph of cigarette pack-years by race and heartdis}

avg_pack_years_race_heartdis %>%
  drop_na(c(heartdis, avg_pack_years)) %>%
  ggplot(aes(x = race, y = avg_pack_years)) +
  geom_bar(aes(fill=race), stat="identity", position = "dodge") +
  coord_flip() +
  guides(fill = "none") +
  labs(x = "Race",
       y = "Average Pack-years (Avg. # of Cigarette Packs Smoked per Year)",
  title = "Average Pack-years by Race & Heart Disease Status",
  caption = "Data Source: 2011 California Smokers Cohort, CA Dept. of Health") +
  scale_y_continuous(labels = function(x) format(x,big.mark=",",
                                                     scientific=FALSE)) +
  facet_wrap(~ heartdis, labeller = labeller(heartdis =
                                      c("No" = "Does Not Have Heart Disease",
                                        "Yes" = "Has Heart Disease")))


```
\newpage
```{r bar graph of cigarette pack-years by race and diabetes}

avg_pack_years_race_diabetes %>%
  drop_na(c(diabetes, avg_pack_years)) %>%
  ggplot(aes(x = race, y = avg_pack_years)) +
  geom_bar(aes(fill=race), stat="identity", position = "dodge") +
  coord_flip() +
  guides(fill = "none") +
  labs(x = "Race",
       y = "Average Pack-years (Avg. # of Cigarette Packs Smoked per Year)",
  title = "Average Pack-years by Race & Diabetes Status",
  caption = "Data Source: 2011 California Smokers Cohort, CA Dept. of Health") +
  scale_y_continuous(labels = function(x) format(x,big.mark=",",
                                                     scientific=FALSE)) +
  facet_wrap(~ diabetes,
             labeller = labeller(diabetes = c("No" = "Does Not Have Diabetes",
                                                      "Yes" = "Has Diabetes")))


```
\newpage
```{r bar graph of cigarette pack-years by race and othmenill}

avg_pack_years_race_othmenill %>%
  drop_na(c(othmenill, avg_pack_years)) %>%
  ggplot(aes(x = race, y = avg_pack_years)) +
  geom_bar(aes(fill=race), stat="identity", position = "dodge") +
  coord_flip() +
  guides(fill = "none") +
  labs(x = "Race",
       y = "Average Pack-years (Avg. # of Cigarette Packs Smoked per Year)",
  title = "Average Pack-years by Race & Mental Illness Status",
  caption = "Data Source: 2011 California Smokers Cohort, CA Dept. of Health") +
  scale_y_continuous(labels = function(x) format(x,big.mark=",",
                                                     scientific=FALSE)) +
  facet_wrap(~ othmenill, labeller = labeller(othmenill =
                                      c("No" = "Does Not Have Mental Illness",
                                        "Yes" = "Has Mental Illness")))


```
\newpage

_**Interpretation of the Four Graphs of Average Pack-years by Race and Disease:**_
\newline
Except for mental illness, among individuals who reported that they do not have asthma, heart disease, and/or diabetes, those who identified as either "White" or "American Indian or Alaskan Native" by race appear to have a greater number of average pack-years (i.e., average number of cigarette packs smoked per year) compared to other races in the 2011 California Smokers Cohort.

Except for mental illness, among individuals who reported that they do have asthma, heart disease, and/or diabetes, those who identified as "Hispanic/Latino" by race appear to have the greatest number of average pack-years (i.e., average number of cigarette packs smoked per year) compared to other races in the 2011 California Smokers Cohort.

\newpage

## Work in progress:

##OUR GROUP'S RESEARCH QUESTION (For reference only to help us think of relevant
#graphs - delete later):
"For this project, we aim to investigate how tobacco use primarily impacts mental illness among smokers in California in 2011, as well as explore how race and location of cigarette purchase can impact disease status."

Visualizations (3 total)
**one print quality tables per scenario**
With Kable: pack-years vs. asthma/heart disease/diabetes/mental illness (1 table)

"Compare the average number of pack-years by at least four disease outcomes (e.g. asthma, heart disease, diabetes, physical illness, and/or mental illness). Provide a print-quality table that shows the average number of pack-years and the disease outcomes."

Average number of pack-years = pack_years/sum(pack_years)

**one print quality plot or chart per scenario**
With ggplot: 1 bar graph (x = disease, y = pack-years)
**one additional table or plot**
With ggplot: dodged bar chart with (x = cigarette purchase location, aes(fill = othmenill) to view cigarette purchase location and mental illness status

# Each visual should include: 
**code**
**legend (if necessary) **
Unless we decide to input a third variable in a graph.

**interpretation (1 to 2 sentences)**

##PDF should be prepared for presentation 
**each part of milestone on new page** 
**only necessary info outputted** 
**show work with "echo"**
